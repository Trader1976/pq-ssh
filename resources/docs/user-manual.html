<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CPUNK PQ-SSH — User Manual</title>
    <meta name="description" content="User manual for CPUNK PQ-SSH (profile-based SSH client with PQ status, settings, file transfer and logging)." />

    <!-- IMPORTANT for QTextBrowser + QRC -->
    <link rel="stylesheet" href="qrc:/docs/user-manual.css" />
</head>

<body>
<header class="top">
    <div class="wrap">
        <div class="brand">
            <div class="logo" aria-hidden="true">CP</div>
            <div>
                <h1>CPUNK PQ-SSH</h1>
                <p class="subtitle">User Manual</p>
            </div>
        </div>

        <nav class="nav" aria-label="Manual navigation">
            <a class="btn" href="#getting-started">Getting started</a>
            <a class="btn" href="#profiles">Profiles</a>
            <a class="btn" href="#connect">Connect</a>
            <a class="btn" href="#settings">Settings</a>
            <a class="btn" href="#themes">Themes</a>
            <a class="btn" href="#file-transfer">File transfer</a>
            <a class="btn" href="#pq-status">PQ status</a>
            <a class="btn" href="#key-install">Key install</a>
            <a class="btn" href="#logging">Logging</a>
            <a class="btn" href="#troubleshooting">Troubleshooting</a>
        </nav>
    </div>
</header>

<main class="wrap content">
    <section class="card intro">
        <h2>What PQ-SSH is</h2>
        <p>
            <b>CPUNK PQ-SSH</b> is a profile-based SSH client focused on a clean terminal workflow,
            strong security defaults, and a <b>post-quantum (PQ) readiness indicator</b>.
        </p>

        <div class="callouts">
            <div class="callout">
                <div class="callout-title">Terminal-first</div>
                <p>Connections open a real SSH terminal powered by your system OpenSSH.</p>
            </div>
            <div class="callout">
                <div class="callout-title">Profiles</div>
                <p>Save host/user/port and preferences. Connect with one click.</p>
            </div>
            <div class="callout">
                <div class="callout-title">SFTP workflows</div>
                <p>Optional libssh session enables browsing and file transfers without breaking the terminal experience.</p>
            </div>
        </div>
    </section>

    <section id="getting-started" class="card">
        <h2>Getting started</h2>
        <ol>
            <li>Open <b>PQ-SSH</b>.</li>
            <li>Click <b>Edit profiles…</b>.</li>
            <li>Create a profile (Name, User, Host/IP, Port).</li>
            <li>Select a profile and click <b>Connect</b> (or double-click the profile).</li>
        </ol>

        <div class="note">
            <b>Default behavior:</b> “Open new connection in NEW window” is enabled, so each connection opens separately.
        </div>
    </section>

    <section id="profiles" class="card">
        <h2>Profiles</h2>
        <p>A profile stores connection details and UI preferences:</p>

        <ul class="bullets">
            <li><b>Name</b> — friendly label (e.g. “Server#1”)</li>
            <li><b>User</b> — SSH username (e.g. <code>root</code>)</li>
            <li><b>Host</b> — hostname or IP (e.g. <code>192.168.0.1</code>)</li>
            <li><b>Port</b> — default is <code>22</code></li>
            <li><b>Group</b> — optional label used to organize profiles in the list</li>
            <li><b>Key type</b> — usually <code>auto</code> or <code>openssh</code></li>
            <li><b>Terminal scheme</b> — color scheme for the terminal</li>
        </ul>

        <div class="tip">
            Tip: keep profile names short and consistent (Prod, Staging, Home, etc.) and use Groups to keep the list readable.
        </div>
    </section>

    <section id="connect" class="card">
        <h2>Connecting</h2>
        <ol>
            <li>Select a profile from the list.</li>
            <li>Click <b>Connect</b> (or double-click the profile).</li>
            <li>A terminal window opens and SSH starts automatically.</li>
        </ol>

        <div class="note">
            Terminal sessions are driven by OpenSSH. In parallel, PQ-SSH may connect a libssh session for SFTP features.
        </div>
    </section>

    <section id="settings" class="card">
        <h2>Settings menu</h2>
        <p>
            PQ-SSH includes a Settings dialog to control appearance and logging behavior.
        </p>

        <h3>Where to find it</h3>
        <ul class="bullets">
            <li>From the top menu: <b>File → Settings…</b></li>
        </ul>

        <h3>What happens when you save</h3>
        <ul class="bullets">
            <li>Settings are saved and applied immediately.</li>
            <li>Theme changes take effect instantly (no restart required).</li>
            <li>Logging level changes take effect instantly.</li>
        </ul>

        <div class="note">
            Settings are stored using <code>QSettings</code> under the application name and organization configured by PQ-SSH.
        </div>
    </section>

    <section id="themes" class="card">
        <h2>Themes</h2>
        <p>
            Themes control the look and feel of the main UI (lists, buttons, dialogs, tabs).
            Terminal colors are controlled separately by the selected <b>Terminal scheme</b> in each profile.
        </p>

        <h3>Available themes</h3>
        <ul class="bullets">
            <li><b>CPUNK Dark</b> — dark UI with CPUNK neon accents</li>
            <li><b>CPUNK Orange</b> — dark UI with orange accents</li>
            <li><b>Windows Basic</b> — light/neutral UI (classic desktop feel)</li>
            <li><b>CPUNK Neo</b> — additional CPUNK-styled theme shipped with the app</li>
        </ul>

        <h3>How to change theme</h3>
        <ol>
            <li>Open <b>File → Settings…</b></li>
            <li>Select an <b>App theme</b></li>
            <li>Click <b>Save</b></li>
        </ol>

        <div class="tip">
            If you don’t see a visible change, make sure you clicked <b>Save</b>. PQ-SSH applies the theme when settings are saved.
        </div>
    </section>

    <section id="file-transfer" class="card">
        <h2>File transfer</h2>
        <p>
            PQ-SSH includes a built-in file transfer workflow. It uses a separate <b>libssh</b> session for SFTP operations,
            while the interactive terminal remains powered by OpenSSH.
        </p>

        <h3>Files tab</h3>
        <p>
            The main window includes a <b>Files</b> tab next to the <b>Log</b> tab.
            When SFTP is connected, you can browse the remote filesystem and perform transfers.
        </p>

        <ul class="bullets">
            <li>If libssh connects successfully, the Files tab becomes active and remote listing works.</li>
            <li>If libssh fails, the SSH terminal still works normally, but SFTP features are disabled.</li>
        </ul>

        <h3>Drag &amp; drop uploads</h3>
        <p>
            PQ-SSH supports drag &amp; drop uploads into the terminal workflow:
        </p>
        <ul class="bullets">
            <li>If the libssh session is connected, dropped files are uploaded to the remote current working directory (<code>$PWD</code>).</li>
            <li>If libssh is not connected, PQ-SSH saves the dropped file locally into a safe fallback folder.</li>
        </ul>

        <h3>Local fallback folder</h3>
        <p>
            When the app cannot upload (no SFTP), files are saved locally to:
        </p>
        <pre class="codeblock"><code>~/pqssh_drops/</code></pre>

        <div class="warn">
            <b>Note:</b> The fallback exists to prevent “silent failure” when users expect a drop action to do something.
            It is not a sync folder.
        </div>

        <h3>Common reasons SFTP is disabled</h3>
        <ul class="bullets">
            <li>Authentication fails for the libssh session</li>
            <li>Network/firewall issues</li>
            <li>Profile uses a key type not supported by libssh in PQ-SSH yet</li>
        </ul>
    </section>

    <section id="pq-status" class="card">
        <h2>PQ status indicator</h2>
        <p>
            PQ-SSH runs a quick probe to detect whether the remote server supports a PQ-capable key exchange.
            This does <b>not</b> change server settings; it is informational.
        </p>

        <div class="badges">
            <span class="badge ok">PQ: ACTIVE</span>
            <span class="badge off">PQ: OFF</span>
            <span class="badge wait">PQ: checking…</span>
        </div>

        <ul class="bullets">
            <li><b>PQ: ACTIVE</b> — PQ-safe KEX detected (probe succeeded).</li>
            <li><b>PQ: OFF</b> — server likely does not offer the probed PQ/hybrid KEX.</li>
            <li><b>PQ: checking…</b> — probe in progress.</li>
        </ul>

        <div class="note">
            The indicator is a best-effort UI hint; it does not enforce PQ mode and does not modify SSH server configuration.
        </div>
    </section>

    <section class="card" id="key-install">
        <h2>Installing a public key on a server</h2>
        <p>
            PQ-SSH can install an <b>OpenSSH public key</b> directly to the remote server’s
            <code>~/.ssh/authorized_keys</code> file in a safe, non-destructive way.
        </p>

        <p>This feature is available from:</p>
        <ul class="bullets">
            <li><b>Keys → Install public key to server…</b> (main menu)</li>
            <li><b>Key Generator → Keys tab → Install…</b> (install a selected key)</li>
        </ul>

        <h3>What you see (confirmation step)</h3>
        <p>Before anything is changed on the server, PQ-SSH shows a confirmation dialog with:</p>
        <ul class="bullets">
            <li><b>Target profile name</b></li>
            <li><b>User / host / port</b></li>
            <li><b>Remote path:</b> <code>~/.ssh/authorized_keys</code></li>
            <li><b>Key type</b> (for example <code>ssh-ed25519</code>)</li>
            <li><b>Key preview</b> (a short excerpt of the key)</li>
        </ul>

        <div class="note">
            Nothing happens unless you explicitly confirm.
        </div>

        <h3>What happens on the server</h3>
        <p>After confirmation, PQ-SSH connects using SSH/SFTP and performs these steps:</p>

        <ol>
            <li>
                <b>Ensure the SSH directory exists</b>
                <pre class="codeblock"><code>mkdir -p ~/.ssh
chmod 700 ~/.ssh</code></pre>
            </li>
            <li>
                <b>Read existing <code>authorized_keys</code> (if present)</b>
                <p>If the same key already exists, nothing is changed.</p>
            </li>
            <li>
                <b>Create a timestamped backup (if the file exists)</b>
                <p>
                    If <code>~/.ssh/authorized_keys</code> exists, it is backed up before modification.
                </p>
                <div class="warn">
                    Backup creation is mandatory. If backup fails, key installation is aborted.
                </div>
            </li>
            <li>
                <b>Append the key only if missing</b>
                <p>The public key is added as a new line. Duplicate keys are never inserted.</p>
            </li>
            <li>
                <b>Fix permissions</b>
                <pre class="codeblock"><code>chmod 600 ~/.ssh/authorized_keys</code></pre>
            </li>
        </ol>

        <h3>Safety guarantees</h3>
        <ul class="bullets">
            <li>Existing keys are preserved</li>
            <li>Backup before modification</li>
            <li>No duplicate keys</li>
            <li>Correct SSH permissions enforced</li>
            <li>No passwords or private keys are uploaded</li>
        </ul>
    </section>

    <section id="logging" class="card">
        <h2>Logging &amp; Debug</h2>

        <h3>Logging levels</h3>
        <p>
            Logging verbosity can be controlled from <b>File → Settings…</b>:
        </p>
        <ul class="bullets">
            <li><b>Errors only</b> — minimal logs</li>
            <li><b>Normal</b> — recommended default</li>
            <li><b>Debug</b> — detailed logs for troubleshooting</li>
        </ul>

        <h3>Open the log file</h3>
        <p>Use the menu: <b>Help → Open log file</b></p>

        <pre class="codeblock"><code>~/.local/share/pq-ssh/logs/pq-ssh.log</code></pre>

        <h3>PQ debug mode (UI)</h3>
        <p>
            Enable <b>PQ debug</b> in the bottom bar to show extra diagnostics in the UI
            (SSH command details, scheme lists, low-level messages).
        </p>

        <div class="warn">
            <b>Privacy note:</b> PQ-SSH does not log passwords or private key contents.
            Debug output may still contain hostnames and file paths.
        </div>
    </section>

    <section class="card">
        <h2>Keys &amp; expiration warnings</h2>
        <p>Open <b>Keys → Key Generator…</b> to create/manage keys.</p>

        <ul class="bullets">
            <li>At startup PQ-SSH may auto-mark expired keys in metadata.</li>
            <li>If expired keys exist, a warning is shown in the status area.</li>
            <li>Rotate keys regularly for best security.</li>
        </ul>
    </section>

    <section id="troubleshooting" class="card">
        <h2>Troubleshooting</h2>

        <details>
            <summary>Theme change didn’t apply</summary>
            <ul class="bullets">
                <li>Open <b>File → Settings…</b>, select a theme and click <b>Save</b>.</li>
                <li>If needed, close and re-open the Settings dialog and try again.</li>
            </ul>
        </details>

        <details>
            <summary>Connection fails immediately</summary>
            <ul class="bullets">
                <li>Verify host/IP and port in the profile.</li>
                <li>Check the log file (Help → Open log file).</li>
                <li>Enable <b>PQ debug</b> for detailed SSH diagnostics.</li>
            </ul>
        </details>

        <details>
            <summary>PQ shows OFF</summary>
            <ul class="bullets">
                <li>The server likely does not offer the probed PQ key exchange.</li>
                <li>This is informational; normal SSH can still be secure depending on your policies.</li>
            </ul>
        </details>

        <details>
            <summary>Files tab / SFTP is disabled</summary>
            <ul class="bullets">
                <li>libssh session may fail even if the terminal SSH works.</li>
                <li>Some key types are not supported by libssh yet.</li>
                <li>Check logs for auth or connect errors.</li>
            </ul>
        </details>

        <details>
            <summary>Drag &amp; drop saved locally instead of uploading</summary>
            <ul class="bullets">
                <li>This means SFTP/libssh was not connected at the time of the drop.</li>
                <li>Check whether SFTP is ready and try again, or use the Files tab transfers.</li>
                <li>Local fallback folder: <code>~/pqssh_drops/</code></li>
            </ul>
        </details>

        <details>
            <summary>Too much debug output in UI</summary>
            <ul class="bullets">
                <li>Turn off <b>PQ debug</b>.</li>
                <li>The app will hide noisy lines like SSH command wrappers by default.</li>
            </ul>
        </details>
    </section>

    <footer class="footer">
        <div class="muted">© CPUNK Project — PQ-SSH user documentation</div>
    </footer>
</main>
</body>
</html>
